<!DOCTYPE html>
<html lang="en">
	<head>
		<title>SPAM PROJECT</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				/*position: absolute;*/
				
				font-family: Monospace;
				/*background-color: #000;*/
				/*color: #ff0000;*/
				margin: 0px;
				overflow: hidden;
			}
			
			#textAnna {
				display: none;
				overflow-y:scroll;
    			height:200px
			}
			
			#info2 {
				color: #ccccff;
				font-size: 1.1em;
				/*display:block;
				//position:absolute;
    			/*bottom:0;
   				right:0;*/
			}
			
			#arrows{
				position:absolute;
				top: 30%;
				left: 30%;
			}
			
			#container{
				position:absolute;
				
			}
			
			div.credits{
				font-size: 0.8em;
			}
			
			div a.livebox{
				
				color: #555500;
				text-decoration: underline;
			}
			
			div.info-wrapper{
				position: absolute;
				margin: 1em 0em 0em 1.5em;
				display: block;
				top: 0px;
				/*width:500px;
				height:500px;*/
				/*background:rgba(0,0,0,0.03)*/
			}
			
			div.ul{
				display: inline;
				line-height: 120%;
				list-style-type: none;
			}
			
			div.info {
			
				/*position: absolute;*/
				color: #5555ff;
				font-size: 0.8em;
				
				/*
				top: 10px;
				right: 10px;
				bottom: 10px;
				width: 250px;
				/**/
				
				
			}
			
			#monitor{
			position: absolute;
			display: none !important;
			visibility: hidden;
			}
			
			A:visited {
					color: #0000ff;
			}
			A:link { 
					color: #0000ff;
					text-decoration: none; 
					font-weight: normal ;
			}
			
			/*	
			#info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }*/
			#info2 a, .button { font-family: 'Armata', sans-serif;color: #00c; font-weight: bold; /*text-decoration: underline*/; cursor: pointer ; line-height: 180%;}
			
			#tema{
				color: #ff0000;
			}
			

			
		</style>
		
		<script src="js/three.js"></script>
		
		
		<link href='http://fonts.googleapis.com/css?family=Armata' rel='stylesheet' type='text/css'>
		
		<script src="js/Detector.js"></script>

		<script src="js/THREEx.KeyboardState.js"></script>

		<script type="text/javascript" src="js/webgl-utils.js"></script>
		<script type="text/javascript" src="js/fboTextureUtils.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
		<script type="text/javascript" src="js/jquery.color.js"></script>
		
		<link href="style.css" rel="stylesheet" type="text/css" media="all" />
		<script type="text/javascript" src="js/popUpScript.js"></script>
		
<script id="baseVs" type="x-shader/x-vertex" src="data/baseVs.glsl">
attribute vec3 pos;
attribute vec4 color;
attribute vec2 texcoord;

varying vec2 v_texCoord;
varying vec4 vColor;

void main() {

   gl_Position = vec4((pos.x*1.0),pos.y,pos.z,1.0);
   v_texCoord = texcoord;
   vColor = color;

}
</script>

<script id="translateVs" type="x-shader/x-vertex">
attribute vec3 pos;
attribute vec4 color;
attribute vec2 texcoord;

varying vec2 v_texCoord;
varying vec4 vColor;

uniform float u_mouseX;
uniform float u_mouseY;

vec2 scale = vec2(u_mouseY,u_mouseY);

mat4 rotationMatrix(vec3 axis, float angle)
{
    axis = normalize(axis);
    float s = sin(angle);
    float c = cos(angle);
    float oc = 1.0 - c;
    
    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
                0.0,                                0.0,                                0.0,                                1.0);
}


void main() {

   gl_Position = vec4(pos.x*scale.x,pos.y*scale.y,pos.z,1.0) * rotationMatrix(vec3(0.0,0.0,1.0), u_mouseX);
   v_texCoord = texcoord;
   vColor = color;

}
</script>


<script id="stretchVs" type="x-shader/x-vertex">
attribute vec3 pos;
attribute vec4 color;
attribute vec2 texcoord;

varying vec2 v_texCoord;
varying vec4 vColor;

float scale = 1.25;

void main() {
   vec4 newPos = vec4(((pos.x*-1.0)-0.5)*scale+(0.5*scale),((pos.y*scale)-0.5)*scale+(0.5*scale),pos.z,1.0);
   gl_Position =newPos;
   v_texCoord = texcoord;
   vColor = color;

}
</script>


<script id="baseFs" type="x-shader/x-fragment">

precision highp float;
// our texture
uniform sampler2D u_image;

varying vec2 v_texCoord;

void main() {

  vec4 color = texture2D(u_image, v_texCoord);

  gl_FragColor = vec4(color.r,color.g,color.b,1.0);
}
</script>

<script id="blurFrag" type="x-shader/x-fragment">
precision mediump float;
uniform sampler2D u_image;
uniform float step_w;
uniform float step_h;

varying vec2 v_texCoord;

void main() {

  vec2 tc = v_texCoord;
  vec4 input0 = texture2D(u_image,tc);
   
  vec2 x1 = vec2(step_w, 0.0);
  vec2 y1 = vec2(0.0, step_h);
    
  input0 += texture2D(u_image, tc+x1); // right
  input0 += texture2D(u_image, tc-x1); // left
  input0 += texture2D(u_image, tc+y1); // top
  input0 += texture2D(u_image, tc-y1); // bottom

  input0 *=0.2;

  gl_FragColor = input0;
}
</script>

<script id="blendFrag" type="x-shader/x-fragment">
precision mediump float;
uniform sampler2D u_image;
uniform sampler2D u_image2;
varying vec2 v_texCoord;

float t = 0.01;
void main(){
  vec4 input0 = texture2D(u_image, v_texCoord);
  vec4 input1 = texture2D(u_image2, v_texCoord);

  gl_FragColor = mix(input0, input1, 0.5);
}
</script>


<script id ="embossFrag" type="x-shader/x-fragment">
precision highp float;
varying vec2 v_texCoord;
uniform float time;
uniform sampler2D u_image;
uniform float step_w;
uniform float step_h;

      vec2 offset[9];

      void main() {

        vec2 tc = v_texCoord;
        vec4 input0 = texture2D(u_image,tc);
    
        vec2 x1 = vec2(step_w, 0.0);
        vec2 y1 = vec2(0.0, step_h);

        float kernel2[9];


        vec4 sum2 = input0;


          offset[0] = vec2(-step_w, -step_h);
          offset[1] = vec2(0.0, -step_h);
          offset[2] = vec2(step_w, -step_h);
          offset[3] = vec2(-step_w, 0.0);
          offset[4] = vec2(0.0, 0.0);
          offset[5] = vec2(step_w, 0.0);
          offset[6] = vec2(-step_w, step_h);
          offset[7] = vec2(0.0, step_h);
          offset[8] = vec2(step_w, step_h);

          kernel2[0] = 0.0; kernel2[1] = -0.05; kernel2[2] = 0.0;
          kernel2[3] = 0.0; kernel2[4] = 0.025; kernel2[5] = 0.00;
          kernel2[6] = 0.0; kernel2[7] = 0.025; kernel2[8] = 0.0;


          for (int i = 0; i < 9; i++) {
              sum2 += texture2D(u_image,v_texCoord+offset[i])*(kernel2[i]);
          }

          float avg = (sum2.r+sum2.g+sum2.b)/3.0;

          float color = avg>0.9 ? -0.6 : 0.0;

        gl_FragColor = abs(sum2 + vec4(vec3(color),0.0) + vec4(vec3(0.0),0.0) + vec4(vec3(0.0025),0.0)) ;

      }
</script>

<script id ="contrastFrag" type="x-shader/x-fragment">
precision highp float;
uniform sampler2D u_image;
varying vec2 v_texCoord;

float contrast = 2.0;

void main() {
    vec4 color = texture2D(u_image, v_texCoord);
    const vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);
    
    vec3 AvgLumin = vec3(0.5, 0.5, 0.5);
    
    vec3 intensity = vec3(dot(color.rgb, LumCoeff));
    
    // could substitute a uniform for this 1. and have variable saturation
    vec3 satColor = mix(intensity, color.rgb, 1.);
    vec3 conColor = mix(AvgLumin, satColor, contrast);
    
    float avg = (conColor.r+conColor.g+conColor.b)/3.0;
    vec4 bw = avg >= 0.1 ? vec4(0.6) : vec4(0.01);
    gl_FragColor = bw;
}
</script>

<script src="js/adamferriss.js"></script>
</head>

	<body>
		
		<!--<video id="monitor" style="top:0px; left:0px;" autoplay="true" width="120px" height="72px" style="visibility: hidden; display:none !important; float:left;"></video>-->
		<div id= "container"></div>
		<div class=info-wrapper>
		
		  		<div id="info2"><a href="#" class="topopup" id="Popup8">SPAM PROJECT</a><br /></div>
		  <!-- <div id="tema">'I forgot the password and my Doppelgänger will destroy me'<br /><br /></div> -->
				<div class=ul>
							
							<div class='info'><a href="#" class="topopup" id="Popup3">Anna Blumenkranz</a></div>
							<div class='info'><a href="#" class="topopup" id="Popup5">Peter Burr</a></div>
							<div class='info'><a href="#" class="topopup" id="Popup2">Adam Ferriss</a></div>
							<div class='info'><a href="#" class="topopup" id="Popup4">Brian House</a></div>
							<div class='info'><a href="#" class="topopup" id="Popup7">Eva Papamargariti</a></div>
							<div class='info'><a href="#" class="topopup" id="Popup6">Sabrina Ratté</a></div>
							<div class='info'><a href="#" class="topopup" id="Popup1">Yoshihide Sodeka</a></div>
							
							
				</div>
		</div>
		
		
		
		<div id="toPopup8" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
			    <div id="tema"><p align="center">'I forgot the password and my Doppelgänger will destroy me'</p></div>
		        <p align="center">
	          	How confortable you feel about your personal content been spread all over the network? Probably is not a problem for you, because you don´t have nothing to hide.
				You are a very average citizen. Right?
				Ok. Now imagine all your very carefully constructed image that took so long to figure out, not only for the rest of the world but for yourself, is taken by your very enemy. The part of you that speaks to you in the worst moments, highlighting those mistakes the other part of you always try to get rid of and move on. Well, s/he has the password to acces all that mistakes and make with it what ever collage fits the best to destroy you, and you don´t.
				But who cares about identity this days, anyway..
				</p> 
				<div class="credits"><p align="center">
				Spam is a project by Markus Rico and Carolina Romano (aka carolError) .
				</p>
				<p align="center">social managment and concept by <a href= "http://markusrico.com/"  class="livebox" >Markus Rico</a></p> 
		        <p align="center">development and concept by <a href= "https://vimeo.com/carolerror"  class="livebox" >carolError</a></p>   
		        </div></div>
		        
	    </div> 
	    </div> 
		
		
		
		<div id="toPopup1" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
	            Yoshihide Sodeoka is a multidisciplinary artist and musician from Yokohama, Japan, who’s lived in 
	            New York for more than two decades. Sodeoka’s neo-psychedelic work with video, GIFs and print 
	            simultaneously inhabits the world of fine art, music (he’s collaborated with bands like Tame Impala, 
	            Yeasayer and The Presets), fashion (creating art prints for brands and magazines like Sandro Paris, 
	            WAD magazine), and advertising (developing projects with brands like Apple and Nike). </p> 
		        <p align="center"><a href="http://www.sodeoka.com/" class="livebox" >Yoshihide Sodeoka</a></p>   
		        
	    </div> 
	    </div> 
	    
	    
		<div id="toPopup2" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
	          	Adam Ferriss was born in Richmond, VA in 1988. After receiving a BFA from 
	          	The Maryland Institute College of Art in Baltimore, MD he relocated to Los Angeles, 
	          	CA where he currently resides. He is currently enrolled in the Design Media Arts 
	          	program at UCLA where he expects to graduate with an MFA in 2016. </p> 
		        <p align="center"><a href= "http://www.adamferriss.com/"  class="livebox" >Adam Ferriss</a></p>   
		        
	    </div> 
	    </div> 
	    
	    
		<div id="toPopup3" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
	          	Anna Blumenkranz is a media artist and educator, whose work explores the intersection of visual arts, 
	          	critical approach towards technology and its social structures. 
	          	Her key interests include physical computing and wearable technology, 
	          	media archaeology and glitch art. She has collaborated with a range of institutions, 
	          	communities and universities in London and Munich (Victoria & Albert Museum, 
	          	Chelsea College of Arts, Bayerisches Nationmuseum, LMU, Lothringer13, PLATFORM, 
	          	SPIELkultur, KJR, MzTEK – a London-based organisation which encourages women to engage with 
	          	technology, Time and Talents Social community, Cultural Centre GOROD, etc). </p> 
		        <p align="center"><a href= "http://www.annablumenkranz.de/"  class="livebox"  >Anna Blumenkranz</a></p>   
		        
	    </div> 
	    </div> 
	    
	    
		<div id="toPopup4" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
	          	Brian House is a media artist whose work traverses alternative geographies, experimental music, 
	          	and a critical data practice. He is interested in the contingent qualities of information and how 
	          	we experience time in network culture. By constructing embodied, participatory systems, he seeks 
	          	to negotiate between algorithms and the rhythms of everyday life.</p> 
		        <p align="center"><a href= "http://brianhouse.net/"  class="livebox" >Brian House</a></p>   
		        
	    </div> 
	    </div> 
	    
	   
		<div id="toPopup5" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
	          	Peter Burr (b. 1980) is an artist from Brooklyn, NY, USA. His work has been presented in a variety 
	          	of spaces including floating cinemas, cartoon schools, outdoor squats, libraries, national museums 
	          	and more. He is one half of the cartoon group Hooliganship and the founder of Cartune Xprez, an 
	          	animation project that is part video label, part live theater, part weird gang, and part touring 
	          	road show.</p> 
		        <p align="center"><a href= "http://www.peterburr.org"  class="livebox" >Peter Burr</a></p>   
		        
	    </div> 
	    </div> 
	    
	    
		<div id="toPopup6" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
	            Sabrina Ratté (Canada, 1982) is a Montreal based visual artist, mainly working in the field of video. 
	            She completed a BFA and a MFA degree in the film Production Program of Concordia University in Montreal. 
	            Ratté’s video work explores the possibilities of mixing together a diverse array of tools and techniques 
	            in order to create virtual environments where architecture and landscapes fall into abstraction. 
	            Her work is also inspired by the relationship between electronic music and the video image, and she 
	            often collaborates with musicians for finished pieces as well as in live settings.</p>   
		        <p align="center"><a href="http://sabrinaratte.com/" class="livebox"  >Sabrina Ratté</a></p>
	    </div> 
	    </div> 
	    
	    <div id="toPopup7" class="popup">
	    <div class="close"></div>
		<div id="popup_content"> 
		        <p>
				Eva Papamargariti (b.1987) is a Greek architect (received Diploma of Architecture and Engineering from 
				the Department of Architecture, University of Thessaly, 2012) and new media artist. She is currently 
				attending a Master's Degree course in Visual Communication Design, at Royal College of Art, London. 
				Her projects focus on time-based media (digital installations, video, gif animations etc), architecture 
				and graphic design. She is interested in the creation of 2d/3d digital spaces, forms and geometries 
				which can provoke different concepts, narrations and atmospheres each time, using a variety of methods, 
				tools and programs. The themes of motion, destruction and distortion appear often to her work. </p>   
		        <p align="center"><a href="http://evapapamargariti.tumblr.com" class="livebox"  >Eva Papamargariti</a></p>
	    </div> 
	    </div> 
	    
	    <div class="loader"></div>
	    <div id="backgroundPopup"></div>
	    
	    <div id="textAnna">
	    	<p>
				Welcome to twitter, Anna! It's been quite a while since we've heard from you on Instagram. 
				Your Tumblr feed is on fire. You've been missing out...
				PRIVACY is a LUXURY.
				Anna Blume shared Sandra Singh's photo. Anna Blume became friends with Petra Winter. 
				Anna Blume changed her profile picture.
				PRIVACY has become IMPOSSIBLE. Can anyone guarantee TRUE ANONYMITY?
				Hide and seek, says the wind
				In the shade of the woods;
				Hide and seek, says the moon
				To the hazel buds.
				Anonymity LEGALISES crime. Sell drugs. Spread children pornography. Thrive.
				Anonymity PROTECTS. Unveil. Uncover. Inform. Leak.
				#EdwardSnowden is trending on Twitter. #surveillance. #privacy. #prism. #nsa.
				Trapped in Deleuzian SOCIETY OF CONTROL. Surveillance 24/7. CENSORSHIP. DICTATORSHIP. 
				SOCIETY must PROTECT those who SUFFER.
				Find out who has viewed your profile! Track who favorited your tweets! 
				Feel free to tag yourself and others!
				GUILTY
				Somebody just endorsed you
				EVERYONE is GUILTY
				And 6 others like this
				Hide and seek, says the cloud,
				Star on to star;
				Hide and seek, says the wave
				At the harbour bar.
				INDULGE in PARANOIA.
				HIDE ME. ENCRYPT MY THOUGHTS.
				HIDE ME NOW. Oh software almighty. SUDO HIDE ME.
				***
			</p>
		</div>

		
		
	
		
		
		
		<video id="vsodeka" autoplay loop style="display:none">
			<source src="data/sodeka.mp4"  type="video/mp4">
			<source src="data/sodeka.ogg"  type="video/ogg">
		</video>
		<video id="vpeter" autoplay loop style="display:none">
			<source src="data/peter_.mp4"  type="video/mp4">
			<source src="data/peter_.ogg"  type="video/ogg">
		</video>
		<video id="vsabrina1" autoplay loop style="display:none">
			<source src="data/sabrina1.mp4"  type="video/mp4">
			<source src="data/sabrina1.ogg"  type="video/ogg">
		</video>
		<video id="vsabrina2" autoplay loop style="display:none">
			<source src="data/sabrina2.mp4"  type="video/mp4">
			<source src="data/sabrina2.ogg"  type="video/ogg">
		</video>
		<video id="vsabrina3" autoplay loop style="display:none">
			<source src="data/sabrina3.mp4"  type="video/mp4">
			<source src="data/sabrina3.ogg"  type="video/ogg">
		</video>
		<video id="vEva" autoplay loop style="display:none" controls muted>
			<source src="data/vEva.mp4"  type="video/mp4">
			<source src="data/vEva.ogg"  type="video/ogg">
		</video>
		
		<img id="arrows" src="data/arrows.png">
	
		<video id="monitor" style="top:0px; left:0px;" autoplay="true" width="120px" height="72px" style="visibility: hidden; display:none !important; float:left;"></video>
	
		<script>


			var renderer = new THREE.WebGLRenderer();
			adam_ferriss_init(renderer.context,500,375);
			var texture_adam = new THREE.Texture();
			texture_adam.__webglTexture = colorFbo.texture;
			//console.log(colorFbo.texture);
			texture_adam.__webglInit = true;
			

			var clock = new THREE.Clock();
			var olas; // animators
			var container, stats;
			var gif;
			var keyboard = new THREEx.KeyboardState();
			
			var vpeter = new Video("vpeter",802,700);
			var vsodeka = new Video("vsodeka",500,375);
			var vsabrina1 = new Video("vsabrina1",500,375);
			var vsabrina2 = new Video("vsabrina2",500,375);
			var vsabrina3 = new Video("vsabrina3",500,375);
			
			
			var vEva = new Video("vEva",500,375);

			var MovingCube;
			var collidableMeshList = [];

			var camera, scene, time;
			var prevPosition, prevRot;

			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
			const LEFT_WALL = 1;
			const TOP_WALL = 2;
			const RIGHT_WALL = 4;
			const BOTTOM_WALL = 8;
			var prevCasillaY = 0;
			var prevCasillaX = 0;
			var tex = THREE.ImageUtils.loadTexture( "data/tex.png" );
			
			var rayMesh, rayGeo;
			var trumanshow, flagTruman;
			
			var adam = false;
			
			var brian = false;
			var soundB;
			var audio = document.createElement( 'audio' );
			var source = document.createElement( 'source' );
			audio.appendChild( source );
			source.src = 'data/brian_house_anthology.mp3';
			
			var sabrinaCSS = false;
			var adamCSS = false;
			var annaCSS = false;
			var peterCSS = false;
			var brianCSS = false;
			var sodekaCSS = false;
			var evaCSS = false;

			var floorSize, floorPos;
			
			var meshA;
			var AZ = 0; 
			var MZ = 0;
			var counter=1;
			var timeModulo1=0;
			var prevTimeModulo1 = 0;
			var timeModulo2 = 0;
			var prevTimeModulo2 = 0;
			var loop = 0; 
			var NODO;
			var posRandom;
			var textureBody = new THREE.ImageUtils.loadTexture("data/text6.jpg");
			var textureGun = new THREE.ImageUtils.loadTexture("data/Tex_0009_1.jpg");
			
			var duration = 1000;
			var keyframes = 15 /*16*/, interpolation = duration / keyframes;
			var lastKeyframe = 0, currentKeyframe = 0;
			
			var step = 0;
			var mesh;
			var meshAnim;
			var frames = [];
			var currentMesh;
			
			var arrows;
			var keyarr = false;
			
			//var animations;
			var loader = new THREE.JSONLoader();
			var skinnedMesh, animation;
			
			var dir, a;
			var posInLine=0;
			var prevClock = 0;
			//var camera;
			var sizeA = THREE.Vector2(500,375);
			var sizeB = THREE.Vector2(600,360);
			
			var divAnna = document.getElementById('textAnna');
			var textAnna = divAnna.childNodes[1].innerHTML;
			var canvas1 = document.createElement('canvas');
			var w = 1500;
			var h = 1125;
			canvas1.width = w;
			canvas1.height = h;
			var context1= canvas1.getContext('2d');
			context1.fillRect(0,0,w,h);
			
			console.log (context1)
			
			function drawString(ctx, text, posX, posY, textColor, rotation, font, fontSize, maxWidth) {
				var lines = text.split("\n");
				if (!rotation) rotation = 0;
				if (!font) font = "'serif'";
				if (!fontSize) fontSize = 16;
				if (!textColor) textColor = '#000000';
				ctx.save();
				ctx.font = fontSize + "px " + font;
				ctx.fillStyle = textColor;
				ctx.translate(posX, posY);
				ctx.rotate(rotation * Math.PI / 180);
				for (i = 0; i < lines.length; i++) {
			 		ctx.fillText(lines[i],0, i*(fontSize+10));
				}
				ctx.restore();
			}

		    drawString(context1,textAnna,0,50,"white",0,"Monaco",24);
    
		    
			var texture1 = new THREE.Texture(canvas1);
			
			var transText = new THREE.ImageUtils.loadTexture("data/transText.png");

			console.log(texture1);
			texture1.anisotropy = 6;
			texture1.needsUpdate = true;
			
			var textureFace;
			

			
			var lab = [[0,2,2,2,0],
			           [0,0,0,4,0],
			           [3,0,2,2,6],
			           [0,0,0,0,4],
			           [0,8,8,6,0],
			           [4,0,0,0,8]];
			
			var wLEFT = [ [500,500,500,500,500],
			           	  [500,500,500,500,500],
			           	  [500,500,500,500,500],
			           	  [500,500,500,500,500],
			           	  [500,500,500,500,500],
			           	  [500,500,500,500,500]
			];
			
			var wTOP = [ [500,500,500,500,500],
			             [500,500,500,500,500],
			             [500,500,500,500,500],
			             [500,500,500,500,500],
			             [500,500,500,500,500],
			             [500,500,500,500,500]
			];
			
			var wBOTTOM = [ [500,500,500,500,500],
				           	[500,500,500,500,500],
				            [500,500,500,500,500],
				            [500,500,500,500,500],
				            [500,500,500,500,500],
				            [500,500,500,500,640]
			];
			
			var wRIGHT = [ [500,500,500,500,500],
				           [500,500,500,500,500],
				           [500,500,500,500,500],
				           [500,500,500,488,512],
				           [500,500,500,500,500],
				           [500,500,500,500,500]
			];
			
			var hLEFT =  [[375,375,375,375,375],
			              [375,375,375,375,375],
			              [375,375,375,375,375],
			              [375,375,375,375,375],
			              [375,375,375,375,375],
			              [375,375,375,375,375],
			];
			
			var hTOP = [ [375,375,375,375,375],
			             [375,375,375,375,375],
			             [375,375,375,375,375],
			             [375,375,375,375,375],
			             [375,375,375,375,375],
			             [375,375,375,375,375],
			];
			
			var hBOTTOM = [ [375,375,375,375,375],
			                [375,375,375,375,375],
				            [375,375,375,375,375],
				            [375,375,375,375,375],
				            [375,375,375,375,375],
				            [375,375,375,375,360],
			];
			
			var hRIGHT = [ [375,375,375,375,375],
			               [375,375,375,375,375],
				           [375,375,375,375,375],
				           [375,375,375,375,586],
				           [375,375,375,375,375],
				           [375,375,375,375,375],
			];
			
			var texturesIndexLEFT   = [
			                           	[0,0,0,0,0],
						           		[0,0,0,0,0],
						           		[texture_adam,0,0,0,0],
						           		[0,0,0,0,0],
						           		[0,0,0,0,0],
						           		[0,0,0,0,0]
						           		
						           		
			                           ];
			
			var texturesIndexTOP   = [
				                       [0,vsabrina1.texture, vsabrina2.texture , vsabrina3.texture,0],
							           [0,0,0,0,0],
							           [0,0,0,0,0],
							           [0,0,0,0,0],
							           [0,0,0,0,0],
							           [0,0,0,0,0]
			                       ];
			
			var texturesIndexRIGHT   = [
											[0,0,0,0,0],
								           	[0,0,0,texture1,0],
								           	[0,0,0,0,0],
								           	[0,0,0,0,vpeter.texture],
								        	[0,0,0,0,0],
								           	[0,0,0,0,0]
					                       	
			                      		];
			
			var texturesIndexBOTTOM   = [										
			                             	
			                            	[0,0,0,0,0],
								         	[0,0,0,0,0],
								           	[0,0,0,0,0],
								           	[0,0,0,0,0],
								           	[0,vEva.texture,0,0,0],
								           	[0,0,0,0,vsodeka.texture]
			                             
			                             ];
			
			
			var rx, ry, rz;
			
			var sphere;
			
			var mesh, helper, animationsH;
			var animations;
			var skins = [];
			
			var loader = new THREE.JSONLoader();
			
			init();
			animate();
			
			
			/*$(document).keydown( function(key){
				if ( key.originalEvent.key === ' ' ) {
					if ( camera === cameraPersp ){
						camera = cameraSub;
					} else {
						camera = cameraPersp;
					}
				}
			});*/
			
			
			
			function Video(id,wi,hi){
						this.id = id
						this.video = document.getElementById( id );
						this.video.play();
						
						this.image = document.createElement( 'canvas' );
						this.image.width = wi;
						this.image.height = hi;
						if(typeof w==='undefined') wi = window.innerWidth;
						if(typeof h==='undefined') hi = window.innerHeight;
						
						this.imageContext = this.image.getContext( '2d' );
						this.imageContext.fillStyle = '#000000';
						this.imageContext.fillRect( 0, 0, wi, hi );

						this.texture= new THREE.Texture( this.image );
						this.texture.minFilter = THREE.LinearFilter;
						this.texture.magFilter = THREE.LinearFilter;
						
						this.update = function(){
							if ( this.video.readyState === this.video.HAVE_ENOUGH_DATA) {

								this.imageContext.drawImage( this.video, 0, 0 );
	
								if ( this.texture ) this.texture.needsUpdate = true;

							}
						}
						//return this;
			}
			
			function Wall(position, size, texture, textureFace, color){
				var receiveShadow;
				if(typeof color==='undefined') color = 0xCCCCCC;
				if(typeof size==='undefined') {
					size.x = 500; 
					size.y = 375;
				}
				if(texture===0){
					this.faceMaterial = new THREE.MeshPhongMaterial({ ambient: color, color: color});
					receiveShadow = true;
				}else{
					this.textureMaterial = new THREE.MeshBasicMaterial( { map: texture, side:THREE.DoubleSide } );
					this.textureMaterial.transparent = true;
					this.material = new THREE.MeshPhongMaterial({ ambient: color, color: color});
					if ( textureFace === BOTTOM_WALL){
						this.materials = [this.material,this.material,this.material, this.material, this.material, this.textureMaterial];
						//console.log('bottom');
					} else if( textureFace === RIGHT_WALL){
						this.materials = [this.material,this.textureMaterial,this.material, this.material, this.material, this.material];
					} else if( textureFace === LEFT_WALL){
						this.materials = [this.textureMaterial,this.material,this.material, this.material, this.material, this.material];
					}else{
						this.materials = [this.material,this.material,this.material, this.material, this.textureMaterial, this.material];
					};
					this.faceMaterial = new THREE.MeshFaceMaterial( this.materials );
					receiveShadow = false;
				}
				
				this.geo = new THREE.CubeGeometry(size.x,size.y,size.z,1,1,1);
				this.geo.computeFaceNormals();
				this.geo.computeVertexNormals();
				this.mesh = new THREE.Mesh (this.geo,this.faceMaterial);
				
				this.mesh.position.set(position.x,position.y,position.z);
				this.mesh.castShadow = true;
				this.mesh.receiveShadow = receiveShadow;
				
			}
			

			
				function init() {
				
				//container = document.createElement( 'div' );
				//document.body.appendChild( container );
				container = document.getElementById( 'container' );
				
				ry = -180;
				rx = 0;
				rz = 0;
				posRandom = new THREE.Vector3(rx,ry,rz);

				

				scene = new THREE.Scene();
				//scene.fog = new THREE.Fog( 0xffffff, 1000,5000 );
				var ambient = new THREE.AmbientLight( 0xffffff );
				scene.add( ambient );
				
				
				/*cameraPersp = new THREE.OrthographicCamera( 120, window.innerWidth / window.innerHeight *9000, -100000, 100000 );
				cameraPersp = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
				cameraPersp.position.z = 1000;
				cameraPersp.position.y = 3000;
				cameraPersp.lookAt( scene.position );*/
				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
				
				//camera = cameraSub;

				
				renderer.setClearColor( 0x888888 );
				renderer.setSize( window.innerWidth, window.innerHeight-5 );
				//renderer.shadowMapEnabled = true;
				//renderer.shadowMapSoft = true;
				container.appendChild( renderer.domElement );

				var dirLight = new THREE.DirectionalLight( 0xffffff, 0.3 );
				dirLight.position.set( 0,3000, 0 );
				dirLight.target.position.set( 2000, 0, 2000 );
				//dirLight.castShadow = true;
				dirLight.shadowCameraVisible = false;
				dirLight.shadowCameraRight     =  2500;
				dirLight.shadowCameraLeft     = -2500;
				dirLight.shadowCameraTop      =  2500;
				dirLight.shadowCameraBottom   = -2500;
				//dirLight.shadowMapWidth = 1200;
				//dirLight.shadowMapHeight = 1200;
				


				scene.add( dirLight );
				
				//--Brian cave
				
				sphere = new THREE.Mesh( new THREE.SphereGeometry (150, 30, 30, 0, Math.PI*7/4,0,Math.PI/2 ),new THREE.MeshBasicMaterial({color: 0x000, side:THREE.DoubleSide, wireframe:false}));
				
				sphere.position.set(-50,-180,1750);
				sphere.scale.set(1,3,1);
				sphere.rotation.y= -1*(Math.PI/2.5);
				scene.add( sphere );
				var circle = new THREE.Mesh( new THREE.CircleGeometry( 150, 30 ),new THREE.MeshBasicMaterial({color: 0x222222}) );
				circle.rotation.set((Math.PI/2)*-1,0,0); 
				circle.position.set(-50,-179,1750);
				scene.add( circle );
				
				//--
			
				
				floorSize = new THREE.Vector2(3000,3500);
				var trumanH = 1000;
				trumanshow = new THREE.Mesh(new THREE.BoxGeometry(3000,trumanH,3500,5,5,5), 
						new THREE.MeshBasicMaterial({color: 0xff0000, wireframe:true }));
				
				
				var pivot = new THREE.Object3D();
				var pivotFloor = new THREE.Object3D();

				
				// FLOOR
				var floorMaterial = new THREE.MeshPhongMaterial( { 
				    //color: 0x996633, 
				    color: 0xffffff,
				    ambient: 0xffffff,
				    specular: 0xffffff,
				    shininess: 100,
				    side: THREE.DoubleSide
				} ) 
				var floorGeometry = new THREE.PlaneGeometry(floorSize.x, floorSize.y);
				var floor = new THREE.Mesh(floorGeometry, floorMaterial);

				floor.receiveShadow = true;

				floor.rotation.x = Math.PI/2;
				trumanshow.position.set(1500,trumanH/2-180,1750);
				pivotFloor.position.set(floorSize.x/2,-180,floorSize.y/2);
				pivotFloor.add(floor);
				pivot.add(pivotFloor);
				pivot.add(trumanshow);
				pivot.position.set(-500,0,-500);
				scene.add(pivot);
				//scene.add(trumanshow);
				
				//controls = new THREE.OrbitControls( cameraPersp, renderer.domElement );
				// model
				var objects = new Array(4);
				
				//////////////////////////////////////////////////////
				//labetinth
				
				for (var y = 0; y < lab.length; y++) {
					for (var x = 0; x < lab[y].length; x++){
						if (lab[y][x] & LEFT_WALL ){
							var wall = new Wall(new THREE.Vector3(x*500-250,0,y*500),new THREE.Vector3(10,hLEFT[y][x],wLEFT[y][x]),texturesIndexLEFT[y][x], LEFT_WALL);
							scene.add( wall.mesh );
						}
						if(lab[y][x] & TOP_WALL){
							var wall = new Wall(new THREE.Vector3(x*500,0,y*500-250),new THREE.Vector3(wTOP[y][x],hTOP[y][x],10),texturesIndexTOP[y][x], TOP_WALL);
							scene.add( wall.mesh );
						}
						if(lab[y][x] & RIGHT_WALL){
							var wall = new Wall(new THREE.Vector3((x*500+250)-((wRIGHT[y][x]-500)*0.5),(hRIGHT[y][x]-375)*0.5,y*500),new THREE.Vector3(10,hRIGHT[y][x],wRIGHT[y][x]),texturesIndexRIGHT[y][x], RIGHT_WALL);
							scene.add( wall.mesh );
						}
						if(lab[y][x] & BOTTOM_WALL){
							var wall = new Wall(new THREE.Vector3(x*500,0,y*500+250),new THREE.Vector3(wBOTTOM[y][x],hBOTTOM[y][x],10),texturesIndexBOTTOM[y][x], BOTTOM_WALL);
							scene.add( wall.mesh );
						}
					}
				}	

				
				/*rayGeo = new THREE.Geometry();
				rayGeo.vertices.push(new THREE.Vector3(100, 25.1, 100));
				for (var i=0;i<1000;i++){
					rayGeo.vertices.push(new THREE.Vector3(100, 25.1, 100));
				}
				rayMesh = new THREE.Line(rayGeo, new THREE.LineBasicMaterial( {color: 0x00ff00 } ));
				scene.add(rayMesh);*/
				
				var boxGeometry = new THREE.BoxGeometry(100,100,100,1,1,1);
				var wireMaterial = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );
				MovingCube = new THREE.Mesh( boxGeometry, wireMaterial );
				MovingCube.position.set(0, 25.1, 0);
				MovingCube.rotation.y = (Math.PI/2)*-1;;
				//MovingCube.rotation.y = Math.PI/2;
				//MovingCube.position.set(0, 25.1,0);
				
				
				MovingCube.visible = false;
				
				MovingCube.add(camera);
				
				scene.add( MovingCube );
				prevPosition = MovingCube.position.clone();
				prevRot = MovingCube.rotation.clone();

				window.addEventListener( 'resize', onWindowResize, false );

			}
				
			function ensureLoop( animation ) {

				for ( var i = 0; i < animation.hierarchy.length; i ++ ) {

					var bone = animation.hierarchy[ i ];

					var first = bone.keys[ 0 ];
					var last = bone.keys[ bone.keys.length - 1 ];

					last.pos = first.pos;
					last.rot = first.rot;
					last.scl = first.scl;

				}

			}
			
				
			loader.load( "js/asset_6.js", function ( geometry, materials ) {

				geometry.computeVertexNormals();
				geometry.computeBoundingBox();

				ensureLoop( geometry.animations[0] );

				for ( var i = 0, il = materials.length; i < il; i ++ ) {

					var originalMaterial = materials[ i ];
					originalMaterial.skinning = true;
				}
				
				var s = 15;
				
				var material = new THREE.MeshFaceMaterial( materials );
				skinnedMesh = new THREE.SkinnedMesh( geometry, material, false );
				
				skinnedMesh.scale.set( s, s, s );

				skinnedMesh.position.x = 0;
				skinnedMesh.position.y = -180;
				skinnedMesh.position.z = 0;

				skinnedMesh.userData.delta = 25;
				
				NODO = new THREE.Object3D();
				NODO.add(skinnedMesh);
				NODO.position.set(500,0,500);
				
				
				scene.add(NODO);

				animation = new THREE.Animation( skinnedMesh, geometry.animations[0] );
				animation.play();
				animation.update( 0 );

			} );

			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
 
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}
			
			var moveNextFrame = false;
			var firstUpdate = 0;
			
			function update() {
				
				if(sabrinaCSS){
					document.getElementById("Popup6").style.color = "red";
				}else{
					document.getElementById("Popup6").style.color = "blue";
				}
				if(adamCSS){
					document.getElementById("Popup2").style.color = "red";
				}else{
					document.getElementById("Popup2").style.color = "blue";
				}
				if(peterCSS){
					document.getElementById("Popup5").style.color = "red";
				}else{
					document.getElementById("Popup5").style.color = "blue";
				}
				if(annaCSS){
					document.getElementById("Popup3").style.color = "red";
				}else{
					document.getElementById("Popup3").style.color = "blue";
				}
				if(brianCSS){
					document.getElementById("Popup4").style.color = "red";
				}else{
					document.getElementById("Popup4").style.color = "blue";
				}
				if(sodekaCSS){
					document.getElementById("Popup1").style.color = "red";
				}else{
					document.getElementById("Popup1").style.color = "blue";
				}
				if(evaCSS){
					document.getElementById("Popup7").style.color = "red";
					document.getElementById("vEva").muted = false;
				}else{
					document.getElementById("Popup7").style.color = "blue";
					document.getElementById("vEva").muted = true;
				}
				
				if(flagTruman == true){
					trumanshow.visible = true;
				} else {
					trumanshow.visible = false;
				}
				
				if(brian){
					audio.play();
				}else{
					audio.pause();
				}
				MovingCube.position.y = 0;

				var delta = clock.getDelta(); 

				var rotateAngle = 10*Math.PI / 1680 *delta;   // pi/2 radians (90 degrees) per second
				
				if(keyarr){
					arrows = document.getElementById("arrows");
					$(arrows).fadeOut("slow");
					//console.log('keyarr');
				}			
				
				keypressed = false;
				if ( keyboard.pressed("left") ){     
					MovingCube.rotation.y += 100*Math.PI / 180 *delta;
					a = new THREE.Vector3(0,0,0);
					keypressed = true;
				}
				if ( keyboard.pressed("right") ){
					MovingCube.rotation.y -= 100*Math.PI / 180 *delta;
					a = new THREE.Vector3(0,0,0);
					keypressed = true;
				}
				/*if ( keyboard.pressed("W") ){
					MovingCube.rotation.x += 100*Math.PI / 180 *delta;
					a = new THREE.Vector3(0,0,0);
					keypressed = true;
				}
				if ( keyboard.pressed("S") ){
					MovingCube.rotation.x -= 100*Math.PI / 180 *delta;
					a = new THREE.Vector3(0,0,0);
					keypressed = true;
				}
				if ( keyboard.pressed("A") ){
					a = new THREE.Vector3(-1,0,0);
					keypressed = true;
				}
				if ( keyboard.pressed("D") ){
					a = new THREE.Vector3(1,0,0);
					keypressed = true;
				}*/	
				if ( keyboard.pressed("up") ){
					a = new THREE.Vector3(0,0,-1);
					keypressed = true;
				}
				if ( keyboard.pressed("down") ){
					a = new THREE.Vector3(0,0,1);
					keypressed = true;
				}
				
				
				
				
				if(keypressed){
					
					if(!keyarr){
						keyarr = true;
						//console.log('true');
					}

					a.applyQuaternion( MovingCube.quaternion ).normalize().multiplyScalar(10);
					MovingCube.position.add(a);
					var freqStep = 2.0;
					var ampStep = 2.0;
					MovingCube.position.add(new THREE.Vector3(0,Math.sin(clock.getElapsedTime() * 2*Math.PI * freqStep)*ampStep,0));
					
					/*
					posInLine++;
					for(var i=posInLine;i<rayGeo.vertices.length;i++){
						rayGeo.vertices[i] = MovingCube.position.clone();
					}*/
				
					
					var originPoint = prevPosition.clone();
					var localVertex = MovingCube.position.clone();
					var directionVector = localVertex.sub( originPoint );
					
					var casillaY = Math.floor ((MovingCube.position.z + 250 + a.z) / 500 );
					var casillaX = Math.floor ((MovingCube.position.x + 250 + a.x) / 500 );
					
					var collision = false;

					if ((casillaX < 5 && casillaX > 0) && (casillaY < 1)){
						sabrinaCSS = true;
					}else{
						sabrinaCSS = false;
					}
					if ((casillaX == 0) && (casillaY == 2)){
						adamCSS = true;
					}else{
						adamCSS = false;
					}
					if ((casillaX == 4) && (casillaY == 3)){
						peterCSS = true;
					}else{
						peterCSS = false;
					}
					if ((casillaX == 3) && (casillaY == 1)){
						annaCSS = true;
					}else{
						annaCSS = false;
					}
					if ((casillaX == 4) && (casillaY == 5)){
						sodekaCSS = true;
					}else{
						sodekaCSS = false;
					}
					if ((casillaX == 0) && ((casillaY > 2) && (casillaY < 5))){
						brianCSS = true;
					}else{
						brianCSS = false;
					}
					if ((casillaX == 1) && ((casillaY == 4))){
						evaCSS = true;
					}else{
						evaCSS = false;
					}
					
					if( !adam && (casillaX < 2)  && (casillaY == 2)){
						//console.log("adaaaaam!!!");

						adam = true;

					} 
					
					
					
					if ( casillaY < prevCasillaY) {
						if((lab[prevCasillaY][prevCasillaX] & TOP_WALL) || (lab[casillaY][casillaX] & BOTTOM_WALL)){
							collision = true;
						}	
					}
					
					else if ( casillaY > prevCasillaY) {
						if((lab[prevCasillaY][prevCasillaX] & BOTTOM_WALL) || (lab[casillaY][casillaX] & TOP_WALL)){
							collision = true;
						}	
					}
					
					else if ( casillaX < prevCasillaX) {
						if((lab[prevCasillaY][prevCasillaX] & LEFT_WALL) || (lab[casillaY][casillaX] & RIGHT_WALL)){
							collision = true;
						}	
					}
					
					else if ( casillaX > prevCasillaX) {
						if((lab[prevCasillaY][prevCasillaX] & RIGHT_WALL) || (lab[casillaY][casillaX] & LEFT_WALL)){
							collision = true;
						}	
					}
				
					
					if ( MovingCube.position.z > 1600 && MovingCube.position.z < 1850 && MovingCube.position.x > -500 && MovingCube.position.x < 70) {
						//console.log('inside!!!');
						if (!brian){
							brian = true;
							//console.log('toBrian');
						}
						if(prevPosition.z < MovingCube.position.z){
							if (MovingCube.position.z > 1800){
								MovingCube.position.z = prevPosition.z-10;
								//console.log(MovingCube.position.z + ' > 1800');
							}
						}
						if(prevPosition.x > MovingCube.position.x){
							if (MovingCube.position.x < -150){
								MovingCube.position.x = prevPosition.x;
								//console.log(MovingCube.position.x + ' < -150');
							}
						}
						if(prevPosition.x < MovingCube.position.x){
							if (MovingCube.position.x > 50){
								MovingCube.position.x = prevPosition.x;
								//console.log(MovingCube.position.x + ' > 50');
							}
						}
							
					}else{
						brian = false;
					}
					
					var floorHSize = floorSize * 0.5;
					var f1,f2,f3,f4;

					if(prevPosition.x < MovingCube.position.x){
						if (MovingCube.position.x > 2300){
							MovingCube.position.x = prevPosition.x;
							f1 = true;
							//console.log('z+');
						}else{
							f1 = false;
						}
					}
					if(prevPosition.x > MovingCube.position.x){
						if (MovingCube.position.x < -200){
							MovingCube.position.x = prevPosition.x;
							f2 = true;
							//console.log('z-');
						}else{
							f2 = false;
						}
					}
					if(prevPosition.z > MovingCube.position.z){
						if (MovingCube.position.z < -200){
							MovingCube.position.z = prevPosition.z;
							f3 = true;
							//console.log('x-');
						}else{
							f3 = false;
						}
					}
					if(prevPosition.z < MovingCube.position.z){
						if (MovingCube.position.z > 2700){
							MovingCube.position.z = prevPosition.z;
							f4 = true;
							//console.log('x+');
						}else{
							f4 = false;
						}
					}
					if (f1 || f2 || f3 || f4){
						flagTruman = true;
					}else{
						flagTruman = false;
					}
					
				
					if (collision){
						//console.log("collision")
						MovingCube.position.z = prevPosition.z;
						MovingCube.position.x = prevPosition.x;
						MovingCube.rotation.x = prevRot.x;
						MovingCube.rotation.y = prevRot.y;
						MovingCube.rotation.z = prevRot.z;
					}else{
						prevCasillaY = casillaY;
						prevCasillaX = casillaX;
					}
					prevPosition = MovingCube.position.clone();
					prevRot = MovingCube.rotation.clone();
				}
				
				/*if (cameraPersp){
					controls.update(delta);
				}*/

				vsodeka.update();
				vpeter.update();
				vsabrina1.update();
				vsabrina2.update();
				vsabrina3.update();
				
				vEva.update();
				
				if(adam || firstUpdate<60){
					(adam_ferriss_loop(false))();
					firstUpdate++;
					//texture_adam.__webglTexture.update;
				}


				THREE.AnimationHandler.update( 0.4 * delta );
				rx = THREE.Math.randInt(0,2000);
				rz = THREE.Math.randFloat(0,2000);
				if(skinnedMesh){

						if (animation.currentTime > animation.data.length-0.1){
							//console.log('entra');
							rx = THREE.Math.randInt(0,2000);
							rz = THREE.Math.randFloat(0,2000)
							NODO.position.set(rx,0,rz);
						}
					//}
					NODO.lookAt(MovingCube.position);
				}
				

				
			}
			
			

			function render() {
				
				renderer.render( scene, camera );

			}

			function animate() {
				
				
			
				//rayGeo.verticesNeedUpdate = true;
				requestAnimationFrame( animate );				
				render();
				update();

			}
			

			

		</script>

	</body>
</html>
